<?php
/**
 * Created by PhpStorm.
 * User: Alexandr Statut
 * Date: 01.12.2021
 * Time: 11:00
 */

use cfg\Settings,
    system\core\SC;

/*
+----------------------------------------------------------------------------------------------------
| Platform version ( Not change! Setting by author )
+----------------------------------------------------------------------------------------------------
*/
define('VERSION', 'SimpleCoding v.3.4.1');

/*
+----------------------------------------------------------------------------------------------------
| Site root ( in file system )
+----------------------------------------------------------------------------------------------------
*/
const ROOT = __DIR__ . DIRECTORY_SEPARATOR;

/*
+----------------------------------------------------------------------------------------------------
| Project general files type ( usually .php )
+----------------------------------------------------------------------------------------------------
*/
const EXT = '.php';

/*
+----------------------------------------------------------------------------------------------------
| Local autoloader
+----------------------------------------------------------------------------------------------------
*/
if (file_exists(__DIR__ . DIRECTORY_SEPARATOR . 'autoloader.php')) {

    include_once __DIR__ . DIRECTORY_SEPARATOR . 'autoloader.php';
}

/*
+----------------------------------------------------------------------------------------------------
| Vendor autoloader
+----------------------------------------------------------------------------------------------------
*/
if (file_exists(__DIR__ . '/vendor/autoload.php')) {

    require_once __DIR__ . '/vendor/autoload.php';
}

/*
+----------------------------------------------------------------------------------------------------
| First run page
+----------------------------------------------------------------------------------------------------
*/
if (file_exists(__DIR__ . '/install.php') && !system\core\Route::adminFolder()) {
    require_once __DIR__ . '/install.php';
    die;
}

/*
+----------------------------------------------------------------------------------------------------
| Production mode ( on / off )
+----------------------------------------------------------------------------------------------------
*/
define("PROD", Settings::$production);

/*
+----------------------------------------------------------------------------------------------------
| Local site running
+----------------------------------------------------------------------------------------------------
*/
define("LOCAL", strpos(SC::getIp(), "127.0.0.") !== false
    || strpos(SC::getIp(), "192.168.0.") !== false
    || strpos(SC::getIp(), "::1") !== false);

/*
+----------------------------------------------------------------------------------------------------
| Global function
+----------------------------------------------------------------------------------------------------
*/
require_once ROOT . 'system' . DIRECTORY_SEPARATOR . 'global' . EXT;

/*
+----------------------------------------------------------------------------------------------------
| Initialization
+----------------------------------------------------------------------------------------------------
*/
if (PROD) {
    try {
        require_once ROOT . 'system' . DIRECTORY_SEPARATOR . 'init' . EXT;
    } catch (Error $e) {
        SC::logSystemError($e, 'error');
    } catch (Exception $e) {
        SC::logSystemError($e, 'exception');
    } catch (Throwable $e) {
        SC::logSystemError($e, 'throw');
    }
} else {
    require_once ROOT . 'system' . DIRECTORY_SEPARATOR . 'init' . EXT;
}
